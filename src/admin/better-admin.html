<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Scorecard - Team Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }
        
        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .team-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid #e9ecef;
        }
        
        .team-card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .team-card ul {
            list-style: none;
            padding: 0;
        }
        
        .team-card li {
            padding: 8px 0;
            border-bottom: 1px solid #f1f3f4;
        }
        
        .team-card li:last-child {
            border-bottom: none;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .hidden {
            display: none;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .hierarchy {
            margin-top: 15px;
        }
        
        .hierarchy > div {
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }
        
        .hierarchy .manager {
            background: #e3f2fd;
            border-left-color: #2196f3;
        }
        
        .hierarchy .sales-leads {
            background: #f3e5f5;
            border-left-color: #9c27b0;
        }
        
        .hierarchy .teams {
            background: #e8f5e8;
            border-left-color: #4caf50;
        }
        
        .hierarchy .salespeople {
            background: #fff3e0;
            border-left-color: #ff9800;
        }
        
        .hierarchy ul {
            margin: 8px 0 0 0;
            padding-left: 20px;
        }
        
        .hierarchy li {
            padding: 4px 0;
            border-bottom: none;
        }
        
        .team-assignment {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            background: #f8f9fa;
        }
        
        .team-header {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .team-header input {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .team-header input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .team-salespeople {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            resize: vertical;
        }
        
        .team-salespeople:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .remove-team {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        .remove-team:hover {
            background: #c82333;
        }
        
        .team-details {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 5px solid #2196f3;
        }
        
        .team-details h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .team-details p {
            margin: 5px 0;
            color: #333;
        }
        
        .members-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .checkbox-group {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #f9f9f9;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
            font-weight: 500;
        }

        .checkbox-label input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .region-checkboxes {
            margin-top: 10px;
            padding-left: 20px;
            border-left: 2px solid #007bff;
        }

        .region-checkboxes label {
            display: block;
            margin-bottom: 8px;
            font-weight: normal;
        }
        
        .member-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
            margin-bottom: 8px;
            border: 1px solid #e9ecef;
        }
        
        .member-info {
            display: flex;
            flex-direction: column;
        }
        
        .member-name {
            font-weight: 600;
            color: #333;
        }
        
        .member-email {
            font-size: 0.9rem;
            color: #666;
        }
        
        .member-role {
            font-size: 0.8rem;
            color: #667eea;
            font-weight: 600;
            background: #f0f2ff;
            padding: 2px 8px;
            border-radius: 12px;
            display: inline-block;
            margin-top: 4px;
        }
        
        .remove-member {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .remove-member:hover {
            background: #c82333;
        }
        
        .add-member {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 12px;
            border-left: 5px solid #4caf50;
        }
        
        .add-member h4 {
            color: #2e7d32;
            margin-bottom: 15px;
        }
        
        .deletion-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .deletion-option {
            background: #fff5f5;
            border: 2px solid #fed7d7;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .deletion-option h4 {
            color: #c53030;
            margin-bottom: 10px;
        }
        
        .deletion-option p {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .deletion-option select {
            width: 100%;
            padding: 10px;
            border: 2px solid #fed7d7;
            border-radius: 6px;
            background: white;
        }
        
        .deletion-option select:focus {
            outline: none;
            border-color: #c53030;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: transform 0.2s;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            background: linear-gradient(135deg, #c53030 0%, #9c2626 100%);
        }
        
        .team-overview {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
        }
        
        .region-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .region-header {
            font-weight: bold;
            color: #007bff;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .team-item {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 10px;
            margin: 8px 0;
            border-left: 3px solid #28a745;
        }
        
        .team-name {
            font-weight: bold;
            color: #28a745;
            margin-bottom: 5px;
        }
        
        .team-members {
            font-size: 0.9rem;
            color: #666;
        }
        
        .member-list {
            margin-top: 5px;
            padding-left: 15px;
        }
        
        .member-item {
            margin: 2px 0;
            color: #555;
        }
        
        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            background: #f8f9fa;
            border-radius: 12px 12px 0 0;
            padding: 0;
            margin: 0;
            border-bottom: 2px solid #e9ecef;
        }
        
        .tab-button {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
            border-radius: 12px 12px 0 0;
            position: relative;
        }
        
        .tab-button:hover {
            background: #e9ecef;
            color: #333;
        }
        
        .tab-button.active {
            background: white;
            color: #007bff;
            border-bottom: 3px solid #007bff;
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: white;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
            background: white;
            border-radius: 0 0 12px 12px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .tab-icon {
            margin-right: 8px;
            font-size: 1.1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 Sales Scorecard</h1>
            <p>Team Management Dashboard</p>
        </div>
        
        <div class="content">
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-button active" onclick="showTab('dashboard')">
                    <span class="tab-icon">📊</span>Dashboard
                </button>
                <button class="tab-button" onclick="showTab('overview')">
                    <span class="tab-icon">👥</span>Team Overview
                </button>
                <button class="tab-button" onclick="showTab('create')">
                    <span class="tab-icon">➕</span>Create Structure
                </button>
                <button class="tab-button" onclick="showTab('manage')">
                    <span class="tab-icon">⚙️</span>Manage Teams
                </button>
                <button class="tab-button" onclick="showTab('directors')">
                    <span class="tab-icon">👔</span>Sales Directors
                </button>
                <button class="tab-button" onclick="showTab('delete')">
                    <span class="tab-icon">🗑️</span>Delete Data
                </button>
            </div>
            
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="section">
                    <h2>📊 Dashboard</h2>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-number" id="totalRegions">-</div>
                            <div class="stat-label">Regions</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalTeams">-</div>
                            <div class="stat-label">Teams</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalSalespeople">-</div>
                            <div class="stat-label">Salespeople</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalEvaluations">-</div>
                            <div class="stat-label">Evaluations</div>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2>🚀 Quick Actions</h2>
                    <button class="btn btn-success" onclick="createSampleData()">
                        Create Sample Teams
                    </button>
                    <button class="btn btn-info" onclick="refreshData()">
                        Refresh Data
                    </button>
                    <button class="btn btn-warning" onclick="clearAllData()">
                        Clear All Data
                    </button>
                </div>
            </div>
            
            <!-- Team Overview Tab -->
            <div id="overview" class="tab-content">
                <div class="section">
                    <h2>👥 Current Team Overview</h2>
                    <div id="teamOverview" class="team-overview">
                        <p>Loading organizational structure...</p>
                    </div>
                </div>
            </div>
            
            <!-- Create Structure Tab -->
            <div id="create" class="tab-content">
                <div class="section">
                    <h2>➕ Add New Organization Structure</h2>
                    
                    <!-- Region Section -->
                    <div class="form-group">
                        <label for="regionName">Region Name:</label>
                        <input type="text" id="regionName" placeholder="e.g., North America, Europe, Asia-Pacific">
                    </div>
                    
                    <!-- Regional Manager Section -->
                    <div class="form-group">
                        <label for="regionalManager">Regional Manager:</label>
                        <input type="text" id="regionalManager" placeholder="e.g., John Smith (john.smith@company.com)">
                    </div>
                    
                    <!-- Sales Leads Section -->
                    <div class="form-group">
                        <label for="salesLeads">Sales Leads (one per line):</label>
                        <textarea id="salesLeads" rows="3" placeholder="Sarah Johnson (sarah.johnson@company.com)&#10;Mike Davis (mike.davis@company.com)"></textarea>
                    </div>
                    
                    <!-- Teams and Salespeople Section -->
                    <div class="form-group">
                        <label>Teams and Salespeople Assignment:</label>
                        <div id="teamAssignments">
                            <div class="team-assignment">
                                <div class="team-header">
                                    <input type="text" class="team-name" placeholder="Team Name (e.g., Enterprise Sales)" />
                                    <input type="text" class="sales-lead" placeholder="Sales Lead (e.g., Sarah Johnson)" />
                                </div>
                                <textarea class="team-salespeople" rows="3" placeholder="Salespeople (one per line):&#10;Alice Brown (alice.brown@company.com)&#10;Bob Wilson (bob.wilson@company.com)"></textarea>
                            </div>
                        </div>
                        <button type="button" class="btn btn-info" onclick="addTeamAssignment()" style="margin-top: 10px;">
                            ➕ Add Another Team
                        </button>
                    </div>
                    
                    <button class="btn" onclick="addOrganization()">Add Organization Structure</button>
                </div>
            </div>
            
            <!-- Manage Teams Tab -->
            <div id="manage" class="tab-content">
                <div class="section">
                    <h2>⚙️ Manage Existing Teams</h2>
                    <div class="form-group">
                        <label for="selectedTeam">Select Team to Manage:</label>
                        <select id="selectedTeam" onchange="loadTeamDetails()">
                            <option value="">Choose a team...</option>
                        </select>
                    </div>
                    
                    <div id="teamManagement" class="hidden">
                        <div class="team-details">
                            <h3 id="teamName">Team Name</h3>
                            <p><strong>Sales Lead:</strong> <span id="salesLeadName">-</span></p>
                            <p><strong>Region:</strong> <span id="regionName">-</span></p>
                        </div>
                        
                        <div class="team-members">
                            <h4>Current Team Members:</h4>
                            <div id="currentMembers" class="members-list">
                                <!-- Current members will be loaded here -->
                            </div>
                        </div>
                        
                        <div class="add-member">
                            <h4>Add New Team Member:</h4>
                            <div class="form-group">
                                <input type="text" id="newMemberName" placeholder="Full Name (e.g., John Smith)" />
                            </div>
                            <div class="form-group">
                                <input type="email" id="newMemberEmail" placeholder="Email (e.g., john.smith@company.com)" />
                            </div>
                            <div class="form-group">
                                <label for="newMemberRole">Role:</label>
                                <select id="newMemberRole">
                                    <option value="SALESPERSON">Salesperson</option>
                                    <option value="SALES_LEAD">Sales Lead</option>
                                    <option value="SALES_MANAGER">Sales Manager</option>
                                    <option value="REGIONAL_SALES_MANAGER">Regional Sales Manager</option>
                                    <option value="SALES_DIRECTOR">Sales Director</option>
                                    <option value="ADMIN">Admin</option>
                                </select>
                            </div>
                            <button class="btn btn-success" onclick="addTeamMember()">➕ Add Member</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sales Directors Tab -->
            <div id="directors" class="tab-content">
                <div class="section">
                    <h2>👔 Sales Directors Management</h2>
                    <p>Create and manage Sales Directors who oversee regional managers and have access to comprehensive analytics.</p>
                    
                    <!-- Add New Sales Director Form -->
                    <div class="add-member">
                        <h3>➕ Add New Sales Director</h3>
                        <div class="form-group">
                            <label for="newDirectorName">Full Name:</label>
                            <input type="text" id="newDirectorName" placeholder="e.g., John Smith" />
                        </div>
                        <div class="form-group">
                            <label for="newDirectorEmail">Email Address:</label>
                            <input type="email" id="newDirectorEmail" placeholder="e.g., john.smith@company.com" />
                        </div>
                        
                        <div class="form-group">
                            <label>Region Assignment:</label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="assignAllRegions" onchange="toggleAllRegions()" />
                                    <span class="checkmark"></span>
                                    <strong>Assign to ALL regions</strong>
                                </label>
                                <div id="regionCheckboxes" class="region-checkboxes">
                                    <!-- Region checkboxes will be loaded here -->
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="addSalesDirector()" class="btn btn-primary">Add Sales Director</button>
                    </div>
                </div>
                
                <!-- Current Sales Directors -->
                <div class="section">
                    <h3>📋 Current Sales Directors</h3>
                    <div id="currentDirectors" class="members-list">
                        <!-- Current directors will be loaded here -->
                    </div>
                </div>
                
                <!-- All Sales Directors Overview -->
                <div class="section">
                    <h3>📊 All Sales Directors Overview</h3>
                    <div id="directorsOverview" class="members-list">
                        <!-- All directors will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Delete Data Tab -->
            <div id="delete" class="tab-content">
                <div class="section">
                    <h2>🗑️ Delete Data</h2>
                    <p style="color: #dc3545; margin-bottom: 20px;">
                        <strong>⚠️ Warning:</strong> These actions cannot be undone. All data will be permanently deleted.
                    </p>
                    
                    <div class="deletion-options">
                        <div class="deletion-option">
                            <h4>Delete Team</h4>
                            <p>Remove an entire team and all its members</p>
                            <select id="teamToDelete">
                                <option value="">Select team to delete...</option>
                            </select>
                            <button class="btn btn-danger" onclick="deleteTeam()" style="margin-top: 10px;">
                                🗑️ Delete Team
                            </button>
                        </div>
                        
                        <div class="deletion-option">
                            <h4>Delete Region</h4>
                            <p>Remove an entire region and all its teams and members</p>
                            <select id="regionToDelete">
                                <option value="">Select region to delete...</option>
                            </select>
                            <button class="btn btn-danger" onclick="deleteRegion()" style="margin-top: 10px;">
                                🗑️ Delete Region
                            </button>
                        </div>
                        
                        <div class="deletion-option">
                            <h4>Delete Everything</h4>
                            <p>Remove all organizational data (regions, teams, users, salespeople)</p>
                            <button class="btn btn-danger" onclick="deleteEverything()" style="margin-top: 10px;">
                                🗑️ Delete Everything
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="alertContainer"></div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        
        // Show alert
        function showAlert(message, type = 'success') {
            const alertContainer = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alertContainer.appendChild(alert);
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }
        
        // Get display name for role
        function getRoleDisplayName(role) {
            const roleNames = {
                'SALESPERSON': 'Salesperson',
                'SALES_LEAD': 'Sales Lead',
                'SALES_MANAGER': 'Sales Manager',
                'REGIONAL_SALES_MANAGER': 'Regional Manager',
                'SALES_DIRECTOR': 'Sales Director',
                'ADMIN': 'Admin'
            };
            return roleNames[role] || role;
        }
        
        // Create sample data
        async function createSampleData() {
            try {
                const response = await fetch(`${API_BASE}/public-admin/seed/sample-data`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showAlert(`✅ ${result.message}. Created ${result.salespeople} salespeople in ${result.team} team.`);
                    refreshData();
                } else {
                    showAlert('❌ Failed to create sample data', 'error');
                }
            } catch (error) {
                showAlert('❌ Error: ' + error.message, 'error');
            }
        }
        
        // Add new team assignment
        function addTeamAssignment() {
            const container = document.getElementById('teamAssignments');
            const teamAssignment = document.createElement('div');
            teamAssignment.className = 'team-assignment';
            teamAssignment.innerHTML = `
                <div class="team-header">
                    <input type="text" class="team-name" placeholder="Team Name (e.g., Enterprise Sales)" />
                    <input type="text" class="sales-lead" placeholder="Sales Lead (e.g., Sarah Johnson)" />
                </div>
                <textarea class="team-salespeople" rows="3" placeholder="Salespeople (one per line):&#10;Alice Brown (alice.brown@company.com)&#10;Bob Wilson (bob.wilson@company.com)"></textarea>
                <button type="button" class="remove-team" onclick="removeTeamAssignment(this)">🗑️ Remove Team</button>
            `;
            container.appendChild(teamAssignment);
        }
        
        // Remove team assignment
        function removeTeamAssignment(button) {
            const teamAssignment = button.closest('.team-assignment');
            teamAssignment.remove();
        }
        
        // Add new organization structure
        async function addOrganization() {
            const regionName = document.getElementById('regionName').value.trim();
            const regionalManager = document.getElementById('regionalManager').value.trim();
            const salesLeadsText = document.getElementById('salesLeads').value.trim();
            
            if (!regionName || !regionalManager || !salesLeadsText) {
                showAlert('❌ Please fill in region name, regional manager, and sales leads', 'error');
                return;
            }
            
            // Collect team assignments
            const teamAssignments = [];
            const teamElements = document.querySelectorAll('.team-assignment');
            
            for (const teamElement of teamElements) {
                const teamName = teamElement.querySelector('.team-name').value.trim();
                const salesLead = teamElement.querySelector('.sales-lead').value.trim();
                const salespeopleText = teamElement.querySelector('.team-salespeople').value.trim();
                
                if (teamName && salesLead && salespeopleText) {
                    const salespeople = salespeopleText.split('\n').map(s => s.trim()).filter(s => s);
                    teamAssignments.push({
                        teamName,
                        salesLead,
                        salespeople
                    });
                }
            }
            
            if (teamAssignments.length === 0) {
                showAlert('❌ Please add at least one team with salespeople', 'error');
                return;
            }
            
            const salesLeads = salesLeadsText.split('\n').map(s => s.trim()).filter(s => s);
            
            try {
                const response = await fetch(`${API_BASE}/public-admin/create-organization`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        regionName,
                        regionalManager,
                        salesLeads,
                        teamAssignments,
                    }),
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showAlert(`✅ ${result.message}. Created ${result.salespeople} salespeople, ${result.salesLeads} sales leads, and ${result.teams} teams in ${result.region}.`);
                    refreshData();
                    
                    // Clear form
                    document.getElementById('regionName').value = '';
                    document.getElementById('regionalManager').value = '';
                    document.getElementById('salesLeads').value = '';
                    document.getElementById('teamAssignments').innerHTML = `
                        <div class="team-assignment">
                            <div class="team-header">
                                <input type="text" class="team-name" placeholder="Team Name (e.g., Enterprise Sales)" />
                                <input type="text" class="sales-lead" placeholder="Sales Lead (e.g., Sarah Johnson)" />
                            </div>
                            <textarea class="team-salespeople" rows="3" placeholder="Salespeople (one per line):&#10;Alice Brown (alice.brown@company.com)&#10;Bob Wilson (bob.wilson@company.com)"></textarea>
                        </div>
                    `;
                } else {
                    const error = await response.json();
                    showAlert('❌ Failed to create organization: ' + (error.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                showAlert('❌ Error: ' + error.message, 'error');
            }
        }
        
        // Refresh data
        async function refreshData() {
            try {
                // Get dashboard data
                const response = await fetch(`${API_BASE}/public-admin/dashboard`);
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('totalRegions').textContent = data.totalRegions || 0;
                    document.getElementById('totalTeams').textContent = data.totalTeams || 0;
                    document.getElementById('totalSalespeople').textContent = data.totalSalespeople || 0;
                    document.getElementById('totalEvaluations').textContent = data.totalEvaluations || 0;
                }
                
                // Load team overview
                loadTeamOverview();
            } catch (error) {
                showAlert('❌ Error loading data: ' + error.message, 'error');
            }
        }
        
        // Load team overview with actual data
        async function loadTeamOverview() {
            try {
                const response = await fetch(`${API_BASE}/public-admin/teams`);
                if (!response.ok) {
                    throw new Error('Failed to fetch teams');
                }
                
                const teams = await response.json();
                const overviewContainer = document.getElementById('teamOverview');
                
                if (teams.length === 0) {
                    overviewContainer.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No teams found. Create some teams to see the organizational structure.</p>';
                    return;
                }
                
                // Group teams by region
                const regionsMap = new Map();
                teams.forEach(team => {
                    const regionId = team.region.id;
                    if (!regionsMap.has(regionId)) {
                        regionsMap.set(regionId, {
                            name: team.region.name,
                            teams: []
                        });
                    }
                    regionsMap.get(regionId).teams.push(team);
                });
                
                // Build HTML
                let html = '';
                regionsMap.forEach((region, regionId) => {
                    // Get regional manager from the first team's region data
                    const firstTeam = region.teams[0];
                    const regionalManager = firstTeam?.region?.managers?.[0];
                    const regionalManagerName = regionalManager ? regionalManager.displayName : 'No Regional Manager';
                    
                    html += `
                        <div class="region-card">
                            <div class="region-header">🌍 ${region.name}</div>
                            <div class="regional-manager" style="background: #e3f2fd; padding: 10px; margin: 10px 0; border-radius: 6px; border-left: 4px solid #2196f3;">
                                <strong>🏢 Regional Manager:</strong> ${regionalManagerName}
                            </div>
                    `;
                    
                    region.teams.forEach(team => {
                        const managerName = team.manager ? team.manager.displayName : 'No Sales Lead';
                        const salespeople = team.salespeople || [];
                        
                        html += `
                            <div class="team-item">
                                <div class="team-name">👥 ${team.name}</div>
                                <div class="team-members">
                                    <strong>📋 Sales Lead:</strong> ${managerName}<br>
                                    <strong>👨‍💼 Salespeople (${salespeople.length}):</strong>
                                    <div class="member-list">
                        `;
                        
                        salespeople.forEach(person => {
                            html += `<div class="member-item">• ${person.firstName} ${person.lastName} (${person.email})</div>`;
                        });
                        
                        html += `
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                });
                
                overviewContainer.innerHTML = html;
            } catch (error) {
                document.getElementById('teamOverview').innerHTML = `<p style="color: #dc3545;">Error loading team overview: ${error.message}</p>`;
            }
        }
        
        
        // Clear all data
        function clearAllData() {
            if (confirm('⚠️ Are you sure you want to clear all data? This cannot be undone!')) {
                showAlert('🗑️ Clear data feature coming soon!', 'info');
            }
        }
        
        // Load team details when a team is selected
        async function loadTeamDetails() {
            const selectedTeamId = document.getElementById('selectedTeam').value;
            const teamManagement = document.getElementById('teamManagement');
            
            if (!selectedTeamId) {
                teamManagement.classList.add('hidden');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/public-admin/teams/${selectedTeamId}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch team details');
                }
                
                const teamData = await response.json();
                
                // Update team details
                document.getElementById('teamName').textContent = teamData.name;
                document.getElementById('salesLeadName').textContent = teamData.manager?.displayName || 'No manager assigned';
                document.getElementById('regionName').textContent = teamData.region?.name || 'No region';
                
                // Update team members
                const membersContainer = document.getElementById('currentMembers');
                membersContainer.innerHTML = '';
                
                // Combine salespeople and users
                const allMembers = [];
                
                // Add salespeople
                if (teamData.salespeople && teamData.salespeople.length > 0) {
                    teamData.salespeople.forEach(member => {
                        allMembers.push({
                            id: member.id,
                            name: `${member.firstName} ${member.lastName}`,
                            email: member.email,
                            role: 'SALESPERSON',
                            type: 'salesperson'
                        });
                    });
                }
                
                // Add users
                if (teamData.userTeams && teamData.userTeams.length > 0) {
                    teamData.userTeams.forEach(userTeam => {
                        const user = userTeam.user;
                        allMembers.push({
                            id: user.id,
                            name: user.displayName,
                            email: user.email,
                            role: user.role,
                            type: 'user'
                        });
                    });
                }
                
                if (allMembers.length > 0) {
                    allMembers.forEach(member => {
                        const memberElement = document.createElement('div');
                        memberElement.className = 'member-item';
                        memberElement.innerHTML = `
                            <div class="member-info">
                                <div class="member-name">${member.name}</div>
                                <div class="member-email">${member.email || 'No email'}</div>
                                <div class="member-role">${getRoleDisplayName(member.role)}</div>
                            </div>
                            <button class="remove-member" onclick="removeTeamMember('${selectedTeamId}', '${member.id}', '${member.name}', '${member.type}')">
                                🗑️ Remove
                            </button>
                        `;
                        membersContainer.appendChild(memberElement);
                    });
                } else {
                    membersContainer.innerHTML = '<p style="color: #666; font-style: italic;">No team members yet.</p>';
                }
                
                teamManagement.classList.remove('hidden');
            } catch (error) {
                showAlert('❌ Error loading team details: ' + error.message, 'error');
            }
        }
        
        // Add new team member
        async function addTeamMember() {
            const teamId = document.getElementById('selectedTeam').value;
            const memberName = document.getElementById('newMemberName').value.trim();
            const memberEmail = document.getElementById('newMemberEmail').value.trim();
            const memberRole = document.getElementById('newMemberRole').value;
            
            if (!teamId || !memberName || !memberEmail) {
                showAlert('❌ Please select a team and fill in member details', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/public-admin/teams/${teamId}/members`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: memberName,
                        email: memberEmail,
                        role: memberRole,
                    }),
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showAlert(`✅ ${result.message}`, 'success');
                    
                    // Clear form
                    document.getElementById('newMemberName').value = '';
                    document.getElementById('newMemberEmail').value = '';
                    document.getElementById('newMemberRole').value = 'SALESPERSON';
                    
                    // Reload team details
                    loadTeamDetails();
                } else {
                    const error = await response.json();
                    showAlert('❌ Failed to add team member: ' + (error.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                showAlert('❌ Error adding team member: ' + error.message, 'error');
            }
        }
        
        // Remove team member
        async function removeTeamMember(teamId, memberId, memberName, memberType) {
            if (!confirm(`⚠️ Are you sure you want to remove ${memberName} from the team?`)) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/public-admin/teams/${teamId}/members/${memberId}?type=${memberType}`, {
                    method: 'DELETE',
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showAlert(`✅ ${result.message}`, 'success');
                    
                    // Reload team details
                    loadTeamDetails();
                } else {
                    const error = await response.json();
                    showAlert('❌ Failed to remove team member: ' + (error.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                showAlert('❌ Error removing team member: ' + error.message, 'error');
            }
        }
        
        // Load teams for the dropdown
        async function loadTeamsForManagement() {
            try {
                const response = await fetch(`${API_BASE}/public-admin/teams`);
                if (!response.ok) {
                    throw new Error('Failed to fetch teams');
                }
                
                const teams = await response.json();
                
                const select = document.getElementById('selectedTeam');
                select.innerHTML = '<option value="">Choose a team...</option>';
                
                teams.forEach(team => {
                    const option = document.createElement('option');
                    option.value = team.id;
                    option.textContent = `${team.name} (${team.region?.name || 'No region'})`;
                    select.appendChild(option);
                });
                
                // Also populate deletion dropdowns
                loadDeletionDropdowns(teams);
            } catch (error) {
                showAlert('❌ Error loading teams: ' + error.message, 'error');
            }
        }
        
        // Load deletion dropdowns
        async function loadDeletionDropdowns(teams) {
            // Load teams for deletion
            const teamDeleteSelect = document.getElementById('teamToDelete');
            teamDeleteSelect.innerHTML = '<option value="">Select team to delete...</option>';
            
            teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team.id;
                option.textContent = `${team.name} (${team.region?.name || 'No region'})`;
                teamDeleteSelect.appendChild(option);
            });
            
            // Load regions for deletion
            const regions = [...new Set(teams.map(team => team.region).filter(region => region))];
            const regionDeleteSelect = document.getElementById('regionToDelete');
            regionDeleteSelect.innerHTML = '<option value="">Select region to delete...</option>';
            
            regions.forEach(region => {
                const option = document.createElement('option');
                option.value = region.id;
                option.textContent = region.name;
                regionDeleteSelect.appendChild(option);
            });
        }
        
        // Delete team
        async function deleteTeam() {
            const teamId = document.getElementById('teamToDelete').value;
            if (!teamId) {
                showAlert('❌ Please select a team to delete', 'error');
                return;
            }
            
            const teamName = document.getElementById('teamToDelete').selectedOptions[0].textContent;
            
            if (!confirm(`⚠️ Are you sure you want to delete the team "${teamName}"?\n\nThis will permanently delete:\n- The team\n- All team members\n- All associated data\n\nThis action cannot be undone!`)) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/public-admin/teams/${teamId}`, {
                    method: 'DELETE',
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showAlert(`✅ ${result.message}`, 'success');
                    refreshData();
                    loadTeamsForManagement();
                } else {
                    const error = await response.json();
                    showAlert('❌ Failed to delete team: ' + (error.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                showAlert('❌ Error deleting team: ' + error.message, 'error');
            }
        }
        
        // Delete region
        async function deleteRegion() {
            const regionId = document.getElementById('regionToDelete').value;
            if (!regionId) {
                showAlert('❌ Please select a region to delete', 'error');
                return;
            }
            
            const regionName = document.getElementById('regionToDelete').selectedOptions[0].textContent;
            
            if (!confirm(`⚠️ Are you sure you want to delete the region "${regionName}"?\n\nThis will permanently delete:\n- The entire region\n- All teams in the region\n- All team members\n- All associated data\n\nThis action cannot be undone!`)) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/public-admin/regions/${regionId}`, {
                    method: 'DELETE',
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showAlert(`✅ ${result.message}`, 'success');
                    refreshData();
                    loadTeamsForManagement();
                } else {
                    const error = await response.json();
                    showAlert('❌ Failed to delete region: ' + (error.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                showAlert('❌ Error deleting region: ' + error.message, 'error');
            }
        }
        
        // Delete everything
        async function deleteEverything() {
            if (!confirm(`⚠️ Are you sure you want to delete EVERYTHING?\n\nThis will permanently delete:\n- All regions\n- All teams\n- All users\n- All salespeople\n- All organizational data\n\nThis action cannot be undone!`)) {
                return;
            }
            
            if (!confirm(`🚨 FINAL WARNING 🚨\n\nYou are about to delete ALL organizational data!\n\nType "DELETE EVERYTHING" to confirm:`)) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/public-admin/delete-everything`, {
                    method: 'DELETE',
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showAlert(`✅ ${result.message}`, 'success');
                    refreshData();
                    loadTeamsForManagement();
                } else {
                    const error = await response.json();
                    showAlert('❌ Failed to delete everything: ' + (error.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                showAlert('❌ Error deleting everything: ' + error.message, 'error');
            }
        }
        
        // Sales Director Management Functions
        async function loadRegionsForDirectors() {
            try {
                const response = await fetch(`${API_BASE}/public-admin/teams`);
                if (!response.ok) {
                    throw new Error('Failed to fetch teams');
                }
                
                const teams = await response.json();
                const regions = [...new Set(teams.map(team => team.region).filter(region => region))];
                
                const regionCheckboxes = document.getElementById('regionCheckboxes');
                regionCheckboxes.innerHTML = '';
                
                regions.forEach(region => {
                    const label = document.createElement('label');
                    label.className = 'checkbox-label';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.value = region.id;
                    checkbox.id = `region_${region.id}`;
                    checkbox.onchange = updateAssignAllCheckbox;
                    
                    const span = document.createElement('span');
                    span.textContent = region.name;
                    
                    label.appendChild(checkbox);
                    label.appendChild(span);
                    regionCheckboxes.appendChild(label);
                });
            } catch (error) {
                showAlert('❌ Error loading regions: ' + error.message, 'error');
            }
        }
        
        function toggleAllRegions() {
            const assignAllCheckbox = document.getElementById('assignAllRegions');
            const regionCheckboxes = document.querySelectorAll('#regionCheckboxes input[type="checkbox"]');
            
            regionCheckboxes.forEach(checkbox => {
                checkbox.checked = assignAllCheckbox.checked;
            });
        }
        
        function updateAssignAllCheckbox() {
            const regionCheckboxes = document.querySelectorAll('#regionCheckboxes input[type="checkbox"]');
            const assignAllCheckbox = document.getElementById('assignAllRegions');
            
            const checkedCount = Array.from(regionCheckboxes).filter(cb => cb.checked).length;
            const totalCount = regionCheckboxes.length;
            
            if (checkedCount === 0) {
                assignAllCheckbox.indeterminate = false;
                assignAllCheckbox.checked = false;
            } else if (checkedCount === totalCount) {
                assignAllCheckbox.indeterminate = false;
                assignAllCheckbox.checked = true;
            } else {
                assignAllCheckbox.indeterminate = true;
                assignAllCheckbox.checked = false;
            }
        }
        
        async function loadCurrentDirectors() {
            try {
                const response = await fetch(`${API_BASE}/public-admin/directors`);
                if (!response.ok) {
                    throw new Error('Failed to fetch directors');
                }
                
                const data = await response.json();
                const directorsContainer = document.getElementById('currentDirectors');
                
                if (data.directors && data.directors.length > 0) {
                    directorsContainer.innerHTML = data.directors.map(director => `
                        <div class="member-item">
                            <div>
                                <strong>${director.displayName || director.email}</strong>
                                <p>${director.email}</p>
                                <p><em>Manages ${director.managedRegions ? director.managedRegions.length : 0} regions</em></p>
                            </div>
                            <button onclick="removeSalesDirector('${director.id}')" class="btn btn-danger btn-sm">Remove</button>
                        </div>
                    `).join('');
                } else {
                    directorsContainer.innerHTML = '<p>No Sales Directors found.</p>';
                }
            } catch (error) {
                showAlert('❌ Error loading directors: ' + error.message, 'error');
            }
        }
        
        async function addSalesDirector() {
            const directorName = document.getElementById('newDirectorName').value.trim();
            const directorEmail = document.getElementById('newDirectorEmail').value.trim();
            const assignAllRegions = document.getElementById('assignAllRegions').checked;
            const selectedRegions = Array.from(document.querySelectorAll('#regionCheckboxes input[type="checkbox"]:checked')).map(cb => cb.value);
            
            if (!directorName || !directorEmail) {
                showAlert('❌ Please fill in director name and email', 'error');
                return;
            }
            
            if (!assignAllRegions && selectedRegions.length === 0) {
                showAlert('❌ Please select at least one region or choose "Assign to ALL regions"', 'error');
                return;
            }
            
            try {
                // For now, we'll use the first selected region or any region for the API call
                // The backend will handle assigning to all regions
                const regionId = selectedRegions.length > 0 ? selectedRegions[0] : 'all';
                
                const response = await fetch(`${API_BASE}/public-admin/regions/${regionId}/directors`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: directorName,
                        email: directorEmail,
                        role: 'SALES_DIRECTOR',
                    }),
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showAlert(`✅ ${result.message}`, 'success');
                    
                    // Clear form
                    document.getElementById('newDirectorName').value = '';
                    document.getElementById('newDirectorEmail').value = '';
                    document.getElementById('assignAllRegions').checked = false;
                    document.querySelectorAll('#regionCheckboxes input[type="checkbox"]').forEach(cb => cb.checked = false);
                    
                    // Reload directors
                    loadCurrentDirectors();
                    loadDirectorsOverview();
                } else {
                    const error = await response.json();
                    showAlert('❌ Failed to add sales director: ' + (error.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                showAlert('❌ Error adding sales director: ' + error.message, 'error');
            }
        }
        
        async function removeSalesDirector(directorId) {
            if (!confirm(`⚠️ Are you sure you want to remove this Sales Director from all regions?`)) {
                return;
            }
            
            try {
                // Use any region ID since the backend removes from all regions
                const response = await fetch(`${API_BASE}/public-admin/regions/any/directors/${directorId}`, {
                    method: 'DELETE',
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showAlert(`✅ ${result.message}`, 'success');
                    
                    // Reload directors
                    loadCurrentDirectors();
                    loadDirectorsOverview();
                } else {
                    const error = await response.json();
                    showAlert('❌ Failed to remove sales director: ' + (error.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                showAlert('❌ Error removing sales director: ' + error.message, 'error');
            }
        }
        
        async function loadDirectorsOverview() {
            try {
                const response = await fetch(`${API_BASE}/public-admin/directors`);
                if (!response.ok) {
                    throw new Error('Failed to fetch directors overview');
                }
                
                const data = await response.json();
                const overviewContainer = document.getElementById('directorsOverview');
                
                if (data.directors.length === 0) {
                    overviewContainer.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No sales directors found. Add some sales directors to see the overview.</p>';
                    return;
                }
                
                let html = '';
                data.directors.forEach(director => {
                    const regions = director.managedRegions || [];
                    html += `
                        <div class="region-card">
                            <div class="region-header">👔 ${director.displayName}</div>
                            <div class="team-members">
                                <strong>Email:</strong> ${director.email}<br>
                                <strong>Regions (${regions.length}):</strong>
                                <div class="member-list">
                    `;
                    
                    regions.forEach(region => {
                        html += `<div class="member-item">• ${region.name}</div>`;
                    });
                    
                    html += `
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                overviewContainer.innerHTML = html;
            } catch (error) {
                document.getElementById('directorsOverview').innerHTML = `<p style="color: #dc3545;">Error loading directors overview: ${error.message}</p>`;
            }
        }
        
        // Tab switching functionality
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab button
            event.target.classList.add('active');
            
            // Load data for specific tabs when they become active
            if (tabName === 'overview') {
                loadTeamOverview();
            } else if (tabName === 'manage') {
                loadTeamsForManagement();
            } else if (tabName === 'directors') {
                loadRegionsForDirectors();
                loadCurrentDirectors();
                loadDirectorsOverview();
            } else if (tabName === 'delete') {
                loadTeamsForManagement(); // Also loads deletion dropdowns
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            refreshData();
            loadTeamsForManagement();
        });
    </script>
</body>
</html>
